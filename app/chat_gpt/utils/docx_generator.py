# import asyncio
# from openai import AsyncOpenAI
# from datetime import datetime
# import os
# from app.config import settings
# from app.chat_gpt.utils.konvert_md_docx import convert_markdown_to_word
#
#
# class KPService:
#     def __init__(self):
#         self.client = AsyncOpenAI(api_key=settings.CHAT_GPT_API_KEY)
#
#     async def generate_kp_content(self, project_description: str) -> str:
#         """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ö–ü —á–µ—Ä–µ–∑ ChatGPT"""
#
#         prompt = f"""
#         –ù–∞ –æ—Å–Ω–æ–≤–µ –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–π –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (–ö–ü) –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown.
#         –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –Ω–∏–∂–µ, –Ω–æ –∞–¥–∞–ø—Ç–∏—Ä—É–π –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç.
#
#         –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê:
#         {project_description}
#
#         –°–¢–†–£–ö–¢–£–†–ê –ö–û–ú–ú–ï–†–ß–ï–°–ö–û–ì–û –ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø –í MARKDOWN:
#
#         # –ü—Ä–æ–µ–∫—Ç: [–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞]
#
#         ## –ü–ª–∞–Ω —Ä–∞–±–æ—Ç—ã
#
#         ### –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:
#         [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ —Å—É—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞]
#
#         ### –≠—Ç–∞–ø 1: Frontend (React/vite)
#
#         | **–ó–∞–¥–∞—á–∞** | **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è** |
#         |------------|-----------------|
#         | [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç 1] | [–û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞] |
#         | [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç 2] | [–û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞] |
#
#         ### –≠—Ç–∞–ø 2: Backend (FastAPI)
#
#         | **–ó–∞–¥–∞—á–∞** | **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è** |
#         |------------|-----------------|
#         | [–ú–æ–¥—É–ª—å 1] | [–û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞] |
#         | [–ú–æ–¥—É–ª—å 2] | [–û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞] |
#
#         ### –≠—Ç–∞–ø 3: –î–∏–∑–∞–π–Ω
#
#         | **–ó–∞–¥–∞—á–∞** | **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è** |
#         |------------|-----------------|
#         | [–≠–ª–µ–º–µ–Ω—Ç –¥–∏–∑–∞–π–Ω–∞ 1] | [–û–ø–∏—Å–∞–Ω–∏–µ] |
#         | [–≠–ª–µ–º–µ–Ω—Ç –¥–∏–∑–∞–π–Ω–∞ 2] | [–û–ø–∏—Å–∞–Ω–∏–µ] |
#
#         ### –≠—Ç–∞–ø 4: –î–µ–ø–ª–æ–π –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
#
#         | **–ó–∞–¥–∞—á–∞** | **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è** |
#         |------------|-----------------|
#         | [–ó–∞–¥–∞—á–∞ –¥–µ–ø–ª–æ—è] | [–û–ø–∏—Å–∞–Ω–∏–µ] |
#
#         ### –¶–µ–Ω–∞/–°—Ä–æ–∫–∏/–≠—Ç–∞–ø—ã
#
#         | **–≠—Ç–∞–ø—ã** | **–°—Ä–æ–∫–∏** | **–¶–µ–Ω–∞** |
#         |-----------|-----------|----------|
#         | [–≠—Ç–∞–ø 1] | [–≤—Ä–µ–º—è] | [—Å—Ç–æ–∏–º–æ—Å—Ç—å] |
#         | [–≠—Ç–∞–ø 2] | [–≤—Ä–µ–º—è] | [—Å—Ç–æ–∏–º–æ—Å—Ç—å] |
#         | **–ò—Ç–æ–≥:** | **[–æ–±—â–µ–µ –≤—Ä–µ–º—è]** | **[–æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å]** |
#
#         –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
#         1. –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º
#         2. –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∏ –ø–æ–ª–µ–∑–Ω–æ–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
#         3. –°—Ä–æ–∫–∏ –∏ —Ü–µ–Ω—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –¥–ª—è –æ–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
#         4. –°–æ—Ö—Ä–∞–Ω—è–π —Ç–∞–±–ª–∏—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ
#         5. –ò—Å–ø–æ–ª—å–∑—É–π —á–∏—Å—Ç—ã–π Markdown –±–µ–∑ HTML
#         6. –ù–µ –¥–æ–±–∞–≤–ª—è–π –ª–∏—à–Ω–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
#         """
#
#         response = await self.client.responses.create(
#             model=settings.CHAT_GPT_MODEL,
#             input=[{"role": "user", "content": prompt}]
#         )
#
#         return response.output_text
#
#     def create_kp_markdown(self, kp_content: str, project_name: str) -> str:
#         """–°–æ–∑–¥–∞–µ—Ç .md —Ñ–∞–π–ª —Å –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º"""
#
#         # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –µ—Å–ª–∏ –Ω–µ—Ç
#         os.makedirs('../generated_kp', exist_ok=True)
#
#         # –°–æ–∑–¥–∞–µ–º –ø–æ–ª–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ Markdown
#         full_content = f"""# –ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: {project_name}
#
# **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** {datetime.now().strftime("%d.%m.%Y")}
#
# {kp_content}
#
# ---
# *–î–∞–Ω–Ω–æ–µ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∑–∞–∫–∞–∑—á–∏–∫–∞.*
# """
#
#         # –°–æ—Ö—Ä–∞–Ω—è–µ–º .md —Ñ–∞–π–ª
#         filename = f"–ö–ü_{project_name.replace(' ', '_')}_{datetime.now().strftime('%Y%m%d_%H%M')}.md"
#         filepath = os.path.join('../generated_kp', filename)
#
#         with open(filepath, 'w', encoding='utf-8') as f:
#             f.write(full_content)
#
#         return filepath
#
#     def convert_markdown_to_docx(self, md_filepath: str) -> str:
#         """–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç .md —Ñ–∞–π–ª –≤ .docx"""
#         # –°–æ–∑–¥–∞–µ–º –ø—É—Ç—å –¥–ª—è .docx —Ñ–∞–π–ª–∞
#         docx_filepath = md_filepath.replace('.md', '.docx')
#
#         # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º
#         success, message = convert_markdown_to_word(md_filepath, docx_filepath)
#
#         if success:
#             return docx_filepath
#         else:
#             raise Exception(f"–û—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏: {message}")
#
#     async def create_kp_document(self, project_description: str, project_name: str) -> str:
#         """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: —Å–æ–∑–¥–∞–µ—Ç –ö–ü –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Ç—å –∫ .docx —Ñ–∞–π–ª—É"""
#
#         print("üîÑ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ö–ü —á–µ—Ä–µ–∑ ChatGPT...")
#         kp_content = await self.generate_kp_content(project_description)
#
#         print("üìù –°–æ–∑–¥–∞–µ–º Markdown —Ñ–∞–π–ª...")
#         md_filepath = self.create_kp_markdown(kp_content, project_name)
#
#         print("üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ Word...")
#         docx_filepath = self.convert_markdown_to_docx(md_filepath)
#
#         # –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π .md —Ñ–∞–π–ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
#         # os.remove(md_filepath)
#
#         return docx_filepath
#
#
# # –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è
# async def test_kp_generation():
#     """–¢–µ—Å—Ç–∏—Ä—É–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ö–ü"""
#
#     # –ü—Ä–∏–º–µ—Ä –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
#     project_description = """
#     –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –µ–¥—ã.
#     –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª: –≤—ã–±–æ—Ä —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤, –º–µ–Ω—é, –∫–æ—Ä–∑–∏–Ω–∞, –æ–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–∞, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞.
#     –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: React Native –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞, Node.js –¥–ª—è –±—ç–∫–µ–Ω–¥–∞, MongoDB –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
#     –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤, push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è.
#     –ë—é–¥–∂–µ—Ç: –æ–∫–æ–ª–æ 150000 —Ä—É–±–ª–µ–π, —Å—Ä–æ–∫: 2-3 –º–µ—Å—è—Ü–∞.
#     """
#
#     kp_service = KPService()
#
#     try:
#         print("üöÄ –ù–∞—á–∏–Ω–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ö–ü...")
#         project_name = "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –µ–¥—ã"
#
#         docx_filepath = await kp_service.create_kp_document(project_description, project_name)
#
#         print(f"‚úÖ –ö–ü —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ: {docx_filepath}")
#         print(f"üìÅ –ü–æ–ª–Ω—ã–π –ø—É—Ç—å: {os.path.abspath(docx_filepath)}")
#
#         # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
#         with open(docx_filepath.replace('.docx', '.md'), 'r', encoding='utf-8') as f:
#             content = f.read()
#             print("\nüìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ö–ü (Markdown):")
#             print(content[:500] + "..." if len(content) > 500 else content)
#
#     except Exception as e:
#         print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
#
#
# # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –±–æ—Ç–µ
# async def generate_kp_for_project(project_description: str, project_name: str) -> str:
#     """
#     –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ö–ü –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Ç—å –∫ .docx —Ñ–∞–π–ª—É
#
#     Args:
#         project_description: –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
#         project_name: –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
#
#     Returns:
#         str: –ü—É—Ç—å –∫ —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É .docx —Ñ–∞–π–ª—É
#     """
#     kp_service = KPService()
#     return await kp_service.create_kp_document(project_description, project_name)
#
#
# if __name__ == "__main__":
#     asyncio.run(test_kp_generation())